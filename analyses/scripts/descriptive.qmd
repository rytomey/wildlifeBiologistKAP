---
title: "Descriptive statistics"
date: "`r Sys.Date()`"
format: 
  html:
    html-table-processing: none
    toc: true
    toc-depth: 4
    toc-location: left
    number-sections: true
    code-fold: true
    code-summary: "Show Code"
    fig-cap-location: bottom
    smooth-scroll: true
    theme: flatly
    font-family: serif
    font-size: 12px
    line-height: 150%
    css: styles.css  # Reference your CSS file here
---


## Descriptive Data Frames
```{r}

descriptiveDFS <- list()

## I. Survey Metadata
descriptiveDFS$T1_Duration <- survsum$DURATIONMIN
descriptiveDFS$T2_Progress <- survsum$PROG
descriptiveDFS$T3_CompletionRate <- survsum$FINISHED
descriptiveDFS$T4_ResponseDates <- survuni$RECDATE

## II. Demographics
descriptiveDFS$T5_Age <- survsum$AGE
descriptiveDFS$T6_Gender <- survsum$GENDER
descriptiveDFS$T7_Race <- survsum$RACE
descriptiveDFS$T8_Ethnicity <- survsum$ETHNICITY
descriptiveDFS$T9_Income <- survsum$INCOME
descriptiveDFS$T10_ResidenceCounty <- survsum$RESIDENCE

## III. Education & Experience
descriptiveDFS$T11_Education <- survsum$EDUCATION
descriptiveDFS$T12_Degree <- survsum$DEGREE
descriptiveDFS$T13_TWS <- survsum$TWS
descriptiveDFS$T14_CourseTaken <- survsum$COURSE
descriptiveDFS$T15_CourseRecency <- survsum$COURSETIME
descriptiveDFS$T16_SelfTitle <- survsum$SELFTITLE
descriptiveDFS$T17_Experience <- survsum$BIOTIME
descriptiveDFS$T18_Affiliate <- survsum$AFFILIATEfill

## IV. Practices & Activities
descriptiveDFS$T19_ContactFreq <- survsum$CONTACT
descriptiveDFS$T20_FieldTime <- survsum$FIELD
descriptiveDFS$T21_CollectSamples <- survsum$COLLECT
descriptiveDFS$T22_HandleLive <- survsum$HANDLE
descriptiveDFS$T23_AnimalState <- survsum$STATE
descriptiveDFS$T24_UsePPE <- survsum$PPE
descriptiveDFS$T25_PPEFrequency <- survsum$PPETIME
descriptiveDFS$T26_CountiesWorked <- survsum$COUNTIES
descriptiveDFS$T27_LicenseHeld <- survsum$LICENSE

## V. Health Knowledge
descriptiveDFS$T28_PIGS <- survsum$PIGS
descriptiveDFS$T29_BRUCE <- survsum$BRUCE
descriptiveDFS$T30_CWD <- survsum$CWD
descriptiveDFS$T31_FLUAL <- survsum$FLUAL
descriptiveDFS$T32_COVID <- survsum$COVID
descriptiveDFS$T33_COVIDSPILL <- survsum$COVIDSPILL
descriptiveDFS$T34_RABIESAL <- survsum$RABIESAL
descriptiveDFS$T35_RABIES <- survsum$RABIES
descriptiveDFS$T36_TURKEY <- survsum$TURKEY
descriptiveDFS$T37_CORRECT_Total <- as_tibble(survuni$CORRECT)
descriptiveDFS$T38_CERTAIN_Total <- as_tibble(survuni$CERTAIN)
descriptiveDFS$T39_CCORRECT_Total <- as_tibble(survuni$CCORRECT)

## VI. Attitudes & Beliefs
attitude_items <- c("CWDAL", "BATS", "PPEREQ", "EHD", "DARWIN", "POPRED", "POPPLAN",
                    "SURVEY", "VACCINE", "PREVAL", "DIVERSE", "CONSEQ", "CLIMATE",
                    "EDREQ", "INFO", "HANDSON")
for (item in attitude_items) {
  descriptiveDFS[[paste0("T40_Attitude_", item)]] <- survsum[[item]]
  descriptiveDFS[[paste0("T41_Neutral_", item)]] <- as_tibble(survuni[[paste0(item, "NEUTRAL")]])
}

descriptiveDFS$T42_NeutralCount <- as_tibble(survuni$NEUTRAL)

## VII. Information Seeking & Preferences
descriptiveDFS$T43_SourceSelection <- selFUN(surv, SOURCE)
descriptiveDFS$T44_SourceOther <- survsum$othSOURCE
descriptiveDFS$T45_SourceCount <- as_tibble(survuni$SOURCEsel2)

descriptiveDFS$T46_CountySelection <- selFUN(surv, COUNTIES)
descriptiveDFS$T47_CountyCount <- as_tibble(survuni$COUNTIESsel2)

descriptiveDFS$T48_TopicSelection <- selFUN(surv, TOPICS)
descriptiveDFS$T49_TopicOther <- survsum$othTOPICS
descriptiveDFS$T50_TopicCount <- as_tibble(survuni$TOPICSsel2)

descriptiveDFS$T51_FormatSelection <- selFUN(surv, FREEINFO)
descriptiveDFS$T52_FormatOther <- survsum$othFREEINFO
descriptiveDFS$T53_FormatCount <- as_tibble(survuni$FREEINFOsel2)

```

# Exports
```{r}
#| include: false

###### Processed Responses ######
oup = file.path(analyses, "outputs")
write.csv(surv, file.path(oup, "descriptiveKAP.csv"), row.names = FALSE)
write_xlsx(descriptiveDFS, path = file.path(oup, "descriptiveDFS.xlsx"))

```

### Descriptive
```{r}

# ---- PATHS ----
base <- normalizePath(file.path("..", ".."), mustWork = FALSE)  
analyses <- file.path(base, "analyses")
inp <- file.path(analyses, "inputs")
oup <- file.path(analyses, "outputs")

kap <- read.csv(file.path(inp, "progover60.csv"))

# ---- CLEAN DATA ----
kap <- kap %>% clean_names()

# ---- DOMAIN VARIABLES ----
demographic_vars <- c("dob", "resident", "zipcode", "race", "ethnicity", "gender", "income", "education", "degree")
experience_vars  <- c("selftitle", "biotime", "affiliate", "contact", "field", "collect", "handle", "counties", "state")
knowledge_vars   <- c("pigs", "bruce", "cwd", "flual", "flu", "covid", "covidspill", "rabiesal", "rabies", "turkey")
attitude_vars    <- c("cwdal", "bats", "ppereq", "ehd", "darwin", "popred", "popplan", "survey", 
                      "vaccine", "preval", "diverse", "conseq", "climate", "edreq", "info", "handson")
practice_vars    <- c("ppe", "ppetime", "source", "interest", "freeinfo", "topics")

# ---- FORMATTING FUNCTION ----
summarize_var <- function(df, vars) {
  df %>%
    select(any_of(vars)) %>%
    mutate(across(everything(), as.character)) %>%
    pivot_longer(cols = everything(), names_to = "Variable", values_to = "Response") %>%
    filter(!is.na(Response)) %>%
    group_by(Variable, Response) %>%
    summarise(N = n(), .groups = "drop") %>%
    group_by(Variable) %>%
    mutate(
      Percent = round(100 * N / sum(N), 1),
      Variable = str_to_title(Variable)
    ) %>%
    arrange(Variable, desc(N)) %>%
    select(Variable, Response, N, Percent)
}

# ---- GENERATE TABLES ----
demographic <- summarize_var(kap, demographic_vars)
experience  <- summarize_var(kap, experience_vars)
knowledge   <- summarize_var(kap, knowledge_vars)
attitude    <- summarize_var(kap, attitude_vars)
practice    <- summarize_var(kap, practice_vars)

# ---- EXPORT TO EXCEL ----
write.xlsx(
  list(
    Demographics = demographic,
    Experience   = experience,
    Knowledge    = knowledge,
    Attitudes    = attitude,
    Practices    = practice
  ),
  file = file.path(oup, "descriptive.xlsx"),
  overwrite = TRUE
)


cat("âœ… Descriptive statistics exported to 'descriptive.xlsx'\n")
```


```

## Technical Refs

```{r bib}
#| echo: false

#### To write a bib file
# knitr::write_bib(sub("^package:", "", grep("package", search(), value=TRUE)), file='pckg.bib')

#### to display the packages within the .qmd without creating another .bib ####
knitr::write_bib(sub("^package:", "", grep("package", search(), value=TRUE)), file='')

```
